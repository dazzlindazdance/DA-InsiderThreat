<form>
  <label>User Metrics</label>
  <search id="base_search1">
    <query>index=it_risk |  `get_identity4insiderevents(risk_object)`| search risk_object_identity="darren.dance"|eval search_name=case(source="Manual Risk Score Modification",source,source="Risk Score Degradation","Risk Score Reduction",1=1,search_name)|stats count by search_name,risk_score,_time|addinfo</query>
    <earliest>-7d@h</earliest>
    <latest>now</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="risk_object" searchWhenChanged="true">
      <label>Identity</label>
      <fieldForLabel>risk_object</fieldForLabel>
      <fieldForValue>risk_object</fieldForValue>
      <search>
        <query>index=it_risk | stats values(risk_object) AS risk_object | mvexpand risk_object</query>
        <earliest>0</earliest>
        <latest></latest>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <viz type="horseshoe_meter_app.horseshoe_meter">
        <title>Current User Risk Score</title>
        <search base="base_search1">
          <query> | stats sum(risk_score) AS "Current Score"</query>
        </search>
        <option name="drilldown">none</option>
        <option name="horseshoe_meter_app.horseshoe_meter.backgroundColor">#FFF</option>
        <option name="horseshoe_meter_app.horseshoe_meter.dialColor">#d0d5d9</option>
        <option name="horseshoe_meter_app.horseshoe_meter.maxRangeColor">#b44441</option>
        <option name="horseshoe_meter_app.horseshoe_meter.maxRangeThreshold">100</option>
        <option name="horseshoe_meter_app.horseshoe_meter.maxValue">100</option>
        <option name="horseshoe_meter_app.horseshoe_meter.midRangeColor">#fbcd2f</option>
        <option name="horseshoe_meter_app.horseshoe_meter.midRangeThreshold">10</option>
        <option name="horseshoe_meter_app.horseshoe_meter.minRangeColor">#3fc77a</option>
        <option name="horseshoe_meter_app.horseshoe_meter.minValue">0</option>
        <option name="horseshoe_meter_app.horseshoe_meter.thresholdStyle">realValue</option>
        <option name="horseshoe_meter_app.horseshoe_meter.useRangemap">true</option>
        <option name="horseshoe_meter_app.horseshoe_meter.valueColor">#555</option>
      </viz>
    </panel>
    <panel>
      <table>
        <search>
          <query>|`identities`| search identity=$risk_object$ | table identity,first,last,nick,email,phone,priority,watchlist,startDate,endDate,bunit,managedBy</query>
        </search>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <viz type="timeline_app.timeline">
        <search base="base_search1">
          <query>| sort -_time |eval duration=60,severity="high"| table _time,search_name,severity,duration | makecontinuous span=1h | fillnull value=" " search_name|fillnull value="null" severity| appendpipe [|stats count | where count=0 | addinfo | rename info_min_time AS _time |table _time,search_name,severity,duration]</query>
        </search>
        <option name="refresh.display">progressbar</option>
        <option name="timeline_app.timeline.axisTimeFormat">DAYS</option>
        <option name="timeline_app.timeline.colorMode">categorical</option>
        <option name="timeline_app.timeline.maxColor">#DA5C5C</option>
        <option name="timeline_app.timeline.minColor">#FFE8E8</option>
        <option name="timeline_app.timeline.numOfBins">6</option>
        <option name="timeline_app.timeline.tooltipTimeFormat">MINUTES</option>
        <option name="timeline_app.timeline.useColors">1</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>Risk Scoring over Last 7 Days</title>
      <chart>
        <search base="base_search1">
          <query>| replace * with tmp_* IN search_name |timechart span=1d sum(risk_score) by search_name|addtotals label=score tmp_* |rename tmp_* AS * |eventstats sum(Total) AS Total</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">Total</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Notables Generated in the Last year</title>
      <chart>
        <search>
          <query>`notable`| search security_domain="insider" risk_object="$risk_object$"| rex "risk_score=\"(?&lt;it_risk_score&gt;\d+)\""| stats values(status_group) AS status_group by risk_score,_time| table _time,status_group,risk_score | rename status_group AS "Current Ticket Status",risk_score AS "Risk Score"|xyseries _time,"Current Ticket Status","Risk Score"| appendpipe [| stats count | where count=0 | eval "Current Ticket Status"="None Found","Risk Score"="-"| fields - count]</query>
          <earliest>-365d@d</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">column</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">/app/DA-InsiderThreat/incident_review?source=Identity%20-%20Insider%20Threat%20Risk%20Threshold%20Breached%20-%20Rule&amp;search=user%253D$risk_object$&amp;earliest=-365d&amp;latest=now</link>
        </drilldown>
      </chart>
    </panel>
  </row>
</form>